<div class="modal-overlay">
  <div class="modal-container">

    <!-- Header -->
    <div class="header">
      <span>
        <span class="back-arrow" (click)="goBack()">‚Üê</span>
        <span class="back-text">
          You are now appreciating {{ employeeName }}
        </span>
      </span>
      <span class="close" (click)="close()">‚úï</span>
    </div>

    <div class="container">

      <!-- ================= LEFT PANEL ================= -->
      <div class="left">

        <textarea
                #mainTextarea
                class="main-text"
                [(ngModel)]="userText"
                (input)="onTextChange()"
                autofocus
        ></textarea>

        <div class="char-count">
          {{ userText.length }}
        </div>

        <button
                class="rewrite-btn"
                [disabled]="userText.length < 50"
                (click)="rewriteWithAI()"
        >
          ‚ú® Rewrite with AI
        </button>

        <!-- AI Suggestion -->
        <div class="ai-suggestion" *ngIf="showAiSuggestion">
          <div class="ai-label">‚ú® AI Generated Suggestion</div>
          <textarea
                  class="ai-text"
                  [value]="aiText"
                  readonly
          ></textarea>

          <button
                  class="use-btn"
                  (click)="useAiText()"
          >
            Use Suggestion Text
          </button>
        </div>

        <!-- POST button -->
        <div class="post-btn-wrapper">
          <button
                  class="submit-btn"
                  [disabled]="!canSubmit()"
                  (click)="postAppreciation()"
          >
            POST
          </button>
        </div>

      </div>
      <!-- ================= END LEFT ================= -->


      <!-- ================= RIGHT PANEL ================= -->
      <div class="right">

        <!-- GUIDE TITLE -->
        <div class="guide-title">
          AI Assisted Recognition Guide
        </div>

        <!-- SCORE SECTION -->
        <div class="score-wrapper">

          <!-- Circle -->
          <div class="circle-wrapper">

            <svg
                    class="progress-ring"
                    width="80"
                    height="80"
            >
              <!-- Background -->
              <circle
                      class="ring-bg"
                      cx="40"
                      cy="40"
                      r="34">
              </circle>

              <!-- Progress -->
              <circle
                      class="ring-progress"
                      cx="40"
                      cy="40"
                      r="34"
                      [attr.stroke-dasharray]="circumference"
                      [attr.stroke-dashoffset]="dashOffset"
                      [ngClass]="[
                  scoreClass,
                  isCheckingLanguage ? 'checking' : ''
                ]">
              </circle>
            </svg>

            <!-- Inner Value -->
            <div
                    class="score-value"
                    [class.thinking]="isCheckingLanguage"
            >
              {{ score }}%
            </div>

          </div>
          <!-- END circle-wrapper -->

          <!-- AI Coaching Message -->
          <div class="score-text" *ngIf="aiGuidance">
            <div class="guidance-label" [ngClass]="guidanceType">
              <span *ngIf="guidanceType === 'question'">üí° Quick tip:</span>
              <span *ngIf="guidanceType === 'suggestion' && !showAiSuggestion">üéâ Congratulations!</span>
              <span *ngIf="guidanceType === 'suggestion' && showAiSuggestion">‚ú® Almost there!</span>
            </div>
            <div class="guidance-text">
                <span *ngIf="showAiSuggestion">
                    Suggestions ready ‚Äî check the left panel ‚ú®
                </span>

                <span *ngIf="!showAiSuggestion"
                    [innerHTML]="formatGuidance(aiGuidance)">
                </span>

            </div>

          </div>
          <div class="score-text" *ngIf="!aiGuidance && score === 0">
            <div class="guidance-text neutral">Start typing to get AI guidance....</div>
          </div>

        </div>
        <!-- END score-wrapper -->


        <!-- GUIDE ITEMS -->
        <div
                class="guide-item"
                *ngFor="let item of guideItems"
                [ngClass]="item.status"
        >
          <span>{{ item.label }}</span>

          <span
                  class="icon"
                  *ngIf="item.status === 'success'"
          >
            ‚úì
          </span>

          <span
                  class="icon"
                  *ngIf="item.status === 'error'"
          >
            ‚úï
          </span>

          <span
                  class="icon neutral-icon"
                  *ngIf="item.status === 'neutral'"
          >
            ‚óè
          </span>
        </div>

      </div>
      <!-- ================= END RIGHT ================= -->

    </div>
  </div>
</div>
