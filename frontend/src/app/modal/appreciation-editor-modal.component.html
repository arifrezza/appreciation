<div class="modal-overlay">
  <div class="modal-container">

    <!-- Header -->
    <div class="header">
      <span>
        <span class="back-arrow" (click)="goBack()">‚Üê</span>
        <span class="back-text">
          You are now appreciating {{ employeeName }}
        </span>
      </span>
      <span class="close" (click)="close()">‚úï</span>
    </div>

    <div class="container">

      <!-- ================= LEFT PANEL ================= -->
      <div class="left">

        <div class="textarea-wrapper">
          <div class="ghost-layer" *ngIf="ghostText">
            <span class="ghost-hidden">{{ userText }}</span><span class="ghost-completion">{{ displayGhostText }}</span>
          </div>
          <textarea
                  #mainTextarea
                  class="main-text"
                  [(ngModel)]="userText"
                  (input)="onTextChange()"
                  (keydown)="onKeydown($event)"
                  [class.has-ghost]="ghostText"
                  autofocus
          ></textarea>
        </div>

        <div class="char-count-row">
          <span class="ghost-hint" *ngIf="ghostText">Press <kbd>Tab</kbd> to accept</span>
          <span class="char-count">{{ userText.length }}</span>
        </div>

        <button
                class="rewrite-btn"
                [disabled]="userText.length < 50 || countAllPassed() < 2 || countAllPassed() === 5"
                (click)="rewriteWithAI()"
        >
          ‚ú® Rewrite with AI
        </button>

        <!-- AI Suggestion -->
        <div class="ai-suggestion" *ngIf="showAiSuggestion">
          <div class="ai-label">‚ú® AI Generated Suggestion</div>
          <textarea
                  class="ai-text"
                  [value]="aiText"
                  readonly
          ></textarea>

          <button
                  class="use-btn"
                  (click)="useAiText()"
          >
            Use Suggestion Text
          </button>
        </div>

        <!-- POST button -->
        <div class="post-btn-wrapper">
          <button
                  class="submit-btn"
                  [disabled]="!canSubmit()"
                  (click)="postAppreciation()"
          >
            POST
          </button>
        </div>

      </div>
      <!-- ================= END LEFT ================= -->


      <!-- ================= RIGHT PANEL ================= -->
      <div class="right">

        <!-- Scrollable area: title + score -->
        <div class="right-scrollable">

        <!-- GUIDE TITLE -->
        <div class="guide-title">
          AI Assisted Recognition Guide
        </div>

        <!-- SCORE SECTION -->
        <div class="score-wrapper">

          <!-- TOP: Circle (left) + Guidance (right) -->
          <div class="score-top">

            <!-- Left: Circular Progress -->
            <div class="score-top-left">
              <div class="circle-wrapper">

                <svg
                        class="progress-ring"
                        width="80"
                        height="80"
                >
                  <!-- Background -->
                  <circle
                          class="ring-bg"
                          cx="40"
                          cy="40"
                          r="34">
                  </circle>

                  <!-- Progress -->
                  <circle
                          class="ring-progress"
                          cx="40"
                          cy="40"
                          r="34"
                          [attr.stroke-dasharray]="circumference"
                          [attr.stroke-dashoffset]="dashOffset"
                          [ngClass]="[
                      scoreClass,
                      isCheckingLanguage ? 'checking' : ''
                    ]">
                  </circle>
                </svg>

                <!-- Inner Value -->
                <div
                        class="score-value"
                        [class.thinking]="isCheckingLanguage"
                >
                  {{ score }}%
                </div>

              </div>
            </div>

            <!-- Right: AI Coaching Message -->
            <div class="score-top-right">
              <div class="score-text" *ngIf="aiGuidance">
                <div class="guidance-label" [ngClass]="guidanceType">
                  <span *ngIf="showCongratulation">üéâ Congratulations!</span>
                  <span *ngIf="!showCongratulation && showAiSuggestion">‚ú® Almost there!</span>
                  <span *ngIf="!showCongratulation && !showAiSuggestion">üí° Quick tip:</span>
                </div>
                <div class="guidance-text">
                  <span *ngIf="showAiSuggestion">
                    Suggestions ready ‚Äî check the left panel ‚ú®
                  </span>
                  <span *ngIf="!showAiSuggestion"
                        [innerHTML]="getGuidanceMainText(aiGuidance)">
                  </span>
                </div>
              </div>
              <div class="score-text" *ngIf="!aiGuidance && score === 0">
                <div class="guidance-text neutral">Start typing to get AI guidance....</div>
              </div>
            </div>

          </div>
          <!-- END score-top -->

          <!-- BOTTOM: "Consider phrases such as:" -->
          <div class="score-bottom" *ngIf="getGuidancePhrases(aiGuidance)">
            <div class="guidance-text">
              <span class="try-using">Consider phrases such as:</span>
              <span class="word-suggestions">{{ getGuidancePhrases(aiGuidance) }}</span>
            </div>
          </div>

        </div>
        <!-- END score-wrapper -->

        </div>
        <!-- END right-scrollable -->

        <!-- GUIDE ITEMS (pinned at bottom) -->
        <div
                class="guide-item"
                *ngFor="let item of guideItems"
                [ngClass]="item.status"
        >
          <span>{{ item.label }}</span>

          <span
                  class="icon"
                  *ngIf="item.status === 'success'"
          >
            ‚úì
          </span>

          <span
                  class="icon"
                  *ngIf="item.status === 'error'"
          >
            ‚úï
          </span>

          <span
                  class="icon neutral-icon"
                  *ngIf="item.status === 'neutral'"
          >
            ‚óè
          </span>
        </div>

      </div>
      <!-- ================= END RIGHT ================= -->

    </div>
  </div>
</div>
