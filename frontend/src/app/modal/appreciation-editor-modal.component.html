<div class="modal-overlay">
  <div class="modal-container">

    <!-- Header -->
    <div class="header">
      <span>
        <span class="back-arrow" (click)="goBack()">‚Üê</span>
        <span class="back-text">
          You are now appreciating {{ employeeName }}
        </span>
      </span>
      <span class="close" (click)="close()">‚úï</span>
    </div>

    <div class="container">

      <!-- ================= LEFT PANEL ================= -->
      <div class="left">

        <div class="textarea-wrapper">
          <div class="ghost-layer" *ngIf="ghostText">
            <span class="ghost-hidden">{{ userText }}</span><span class="ghost-completion">{{ displayGhostText }}</span><span class="ghost-hint-inline"> Press Tab ‚Üπ</span>
          </div>
          <textarea
                  #mainTextarea
                  class="main-text"
                  [(ngModel)]="userText"
                  (input)="onTextChange()"
                  (keydown)="onKeydown($event)"
                  [class.has-ghost]="ghostText"
                  autofocus
          ></textarea>
        </div>

        <!-- Spell correction chip bar -->
        <div class="spell-bar" *ngIf="activeCorrections.length > 0">
          <span class="spell-bar-label">Typo fixes:</span>
          <div class="spell-chips">
            <div class="spell-chip" *ngFor="let c of activeCorrections">
              <span class="spell-wrong">{{ c.wrong }}</span>
              <span class="spell-arrow">&rarr;</span>
              <span class="spell-fixed">{{ c.fixed }}</span>
              <button class="spell-accept" (click)="acceptCorrection(c)" title="Accept correction">&check;</button>
              <button class="spell-dismiss" (click)="dismissCorrection(c)" title="Ignore this word">&times;</button>
            </div>
          </div>
          <div class="spell-bulk" *ngIf="activeCorrections.length >= 2">
            <button class="spell-accept-all" (click)="acceptAllCorrections()">Fix all</button>
            <button class="spell-dismiss-all" (click)="dismissAllCorrections()">Ignore all</button>
          </div>
        </div>

        <div class="char-count-row">
          <span class="char-count">{{ userText.length }}</span>
        </div>

        <button class="rewrite-btn" [disabled]="userText.trim().length < 50 || guideItems[0].status === 'error'" (click)="rewriteWithAI(true)">
          ‚ú® Enhance with AI
        </button>

        <!-- AI Suggestion -->
        <div class="ai-suggestion" *ngIf="showAiSuggestion">
          <div class="ai-label">‚ú® AI Generated Suggestion</div>
          <textarea class="ai-text" [value]="aiText" readonly></textarea>

          <button class="use-btn" (click)="useAiText()">
            Use Suggestion Text
          </button>
        </div>

        <!-- POST button -->
        <div class="post-btn-wrapper">
          <button class="submit-btn" [disabled]="!canSubmit()" (click)="postAppreciation()">
            POST
          </button>
        </div>

      </div>
      <!-- ================= END LEFT ================= -->


      <!-- ================= RIGHT PANEL ================= -->
      <div class="right">

        <!-- Scrollable area: title + score -->
        <div class="right-scrollable">

          <!-- GUIDE TITLE -->
          <div class="guide-title">
            Recognition Guide
          </div>

          <!-- SCORE SECTION -->
          <div class="score-wrapper">

            <!-- TOP: Circle (left) + Guidance (right) -->
            <div class="score-top">

              <!-- Left: Circular Progress -->
              <div class="score-top-left">
                <div class="circle-wrapper">

                  <svg class="progress-ring" width="64" height="64">
                    <!-- Background -->
                    <circle class="ring-bg" cx="32" cy="32" r="27">
                    </circle>

                    <!-- Progress -->
                    <circle class="ring-progress" cx="32" cy="32" r="27" [attr.stroke-dasharray]="circumference"
                      [attr.stroke-dashoffset]="dashOffset" [ngClass]="[
                      scoreClass,
                      isCheckingLanguage ? 'checking' : ''
                    ]">
                    </circle>
                  </svg>

                  <!-- Inner Value -->
                  <div class="score-value" [class.thinking]="isCheckingLanguage">
                    {{ score }}%
                  </div>

                </div>
              </div>

              <!-- Right: AI Coaching Message -->
              <div class="score-top-right">
                <div class="score-text" *ngIf="aiGuidance">
                  <!--<div class="guidance-label" [ngClass]="guidanceType">-->
                  <div class="guidance-label"
                    [ngClass]="[guidanceType, scoreClass, isCheckingLanguage ? 'thinking' : '']">
                    <span class="bulb-icon"
                          *ngIf="guidanceType !== 'abusive' && !showCongratulation">üí°</span>

                    <span *ngIf="showCongratulation">üéâ Congratulations!</span>
                    <span *ngIf="!showCongratulation && guidanceType === 'abusive'">‚ö†Ô∏è Offensive</span>
                    <span *ngIf="!showCongratulation && guidanceType !== 'abusive'">Quick AI tip:</span>
                  </div>
                  <div class="guidance-text">
                    <span [innerHTML]="getGuidanceMainText(aiGuidance)"></span>
                  </div>
                </div>
                <div class="score-text" *ngIf="!aiGuidance && score === 0">
                  <div class="guidance-text neutral">Start typing to get AI guidance....</div>
                </div>
              </div>

            </div>
            <!-- END score-top -->

            <!-- BOTTOM: "Consider phrases such as:" -->
            <div class="score-bottom" *ngIf="getGuidancePhrases(aiGuidance)">
              <div class="guidance-text">
                <span class="try-using">Consider phrases such as:</span>
                <span class="word-suggestions">{{ getGuidancePhrases(aiGuidance) }}</span>
              </div>
            </div>

          </div>
          <!-- END score-wrapper -->

        </div>
        <!-- END right-scrollable -->

        <!-- GUIDE ITEMS (pinned at bottom) -->
        <div class="guide-item" *ngFor="let item of guideItems" [ngClass]="item.status">
          <span>{{ item.label }}</span>

          <span class="icon" *ngIf="item.status === 'success'">
            ‚úì
          </span>

          <span class="icon" *ngIf="item.status === 'error'">
            ‚úï
          </span>

          <span class="icon neutral-icon" *ngIf="item.status === 'neutral'">
            ‚óè
          </span>
        </div>

      </div>
      <!-- ================= END RIGHT ================= -->

    </div>
  </div>
</div>
